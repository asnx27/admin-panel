<app-modal>
  @if (modalService.type() === 'delete') {
  <div class="modal">
    <h2 class="modal-title">Confirm Soft Delete</h2>
    <p class="modal-message">Are you sure you want to deactivate this user?</p>
    <div class="modal-actions">
      <button (click)="softDeleteConfirmed()" class="btn btn-danger">
        Yes
      </button>
      <button (click)="cancel()" class="btn btn-secondary">Cancel</button>
    </div>
  </div>
  } @if (modalService.type() === 'edit') {
  <div class="modal">
    <h2 class="modal-title">Edit User</h2>
    <form (ngSubmit)="submitEdit()" [formGroup]="editForm" class="form">
      <div class="form-group">
        <label>Name</label>
        <input type="text" formControlName="name" class="form-input" />
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" formControlName="email" class="form-input" />
      </div>
      <div class="form-group">
        <label>Role</label>
        <select formControlName="role" class="form-input">
          <option value="admin">Admin</option>
          <option value="customer">Customer</option>
          <option value="manager">Manager</option>
        </select>
      </div>
      <div class="modal-actions right">
        <button type="button" (click)="cancel()" class="btn btn-secondary">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">Update</button>
      </div>
    </form>
  </div>
  }
</app-modal>

<div class="card">
  <div class="filters">
    <input
      type="text"
      placeholder="Search..."
      (input)="updateQuery($any($event.target).value)"
      class="form-input search-input"
    />

    <div class="filter-group">
      <label>Role:</label>
      <select
        (change)="updateRole($any($event.target).value)"
        class="form-input"
      >
        <option value="all">All</option>
        <option value="admin">Admin</option>
        <option value="customer">Customer</option>
        <option value="manager">Manager</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Status:</label>
      <select
        (change)="updateStatus($any($event.target).value)"
        class="form-input"
      >
        <option value="all">All</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="banned">Banned</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Per Page:</label>
      <select
        (change)="setPerPage($any($event.target).value)"
        class="form-input"
      >
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
      </select>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (user of filteredUsers(); track user.id) {
      <tr>
        <td class="user-info">
          <img [src]="user.avatarUrl" alt="{{ user.name }}" class="avatar" />
          <span>{{ user.name }}</span>
        </td>

        <td>{{ user.email }}</td>
        <td class="capitalize">{{ user.role }}</td>
        <td><app-status-badge [status]="user.status" /></td>
        <td class="text-center">
          <button class="action-btn edit" (click)="startEdit(user)">
            Edit
          </button>
          <button
            class="action-btn delete"
            (click)="confirmSoftDelete(user.id)"
          >
            Delete
          </button>
        </td>
      </tr>
      }
    </tbody>
  </table>

  <div class="pagination">
    @for (page of pageNumbers(); track page) {
    <button
      (click)="setPage(page)"
      [class.active]="currentPage() === page"
      class="page-btn"
    >
      {{ page }}
    </button>
    }
  </div>
</div>
